import{j as s,u as T}from"./index.CyiiZYD6.js";import{c as g,P as F,a as j,b as v,C as M,d as I,T as y}from"./index.NErPTbHe.js";import{r as i}from"./index.Cj_FO6QK.js";import{r as N}from"./_slug_.5fc4b14a.DR-IcsHS.js";import{t as G}from"./theme-store.BIhrttrH.js";import{t as P}from"./webcontainer.DpdMTyna.js";import"./index.DgoachrA.js";const W=12,$=[/\/node_modules\//];function U({files:e,onFileSelect:l,selectedFile:a,hideRoot:n,scope:t,hiddenFiles:o,className:k}){const m=i.useMemo(()=>[...$,...o??[]],[o]),c=i.useMemo(()=>B(e,n,t,m),[e,n,t,m]),[b,p]=i.useState(()=>new Set);i.useEffect(()=>{p(new Set)},[e]);const f=i.useMemo(()=>{const r=[];let u=Number.MAX_SAFE_INTEGER;for(const x of c){const C=x.depth;u===C&&(u=Number.MAX_SAFE_INTEGER),b.has(x.id)&&(u=Math.min(u,C)),!(u<C)&&r.push(x)}return r},[c,b]);function h(r){p(u=>{const x=new Set(u);return x.has(r)?x.delete(r):x.add(r),x})}return s.jsx("div",{className:g(k,"bg-tk-elements-fileTree-backgroundColor"),children:f.map(r=>{switch(r.kind){case"file":return s.jsx(Z,{selected:a===r.fullPath,file:r,onClick:()=>l?.(r.fullPath)},r.id);case"folder":return s.jsx(X,{folder:r,collapsed:b.has(r.id),onClick:()=>h(r.id)},r.id)}})})}function X({folder:{depth:e,name:l},collapsed:a,onClick:n}){return s.jsx(w,{className:"group bg-tk-elements-fileTree-folder-backgroundColor hover:bg-tk-elements-fileTree-folder-backgroundColorHover text-tk-elements-fileTree-folder-textColor hover:text-tk-elements-fileTree-folder-textColor",depth:e,iconClasses:g("text-tk-elements-fileTree-folder-iconColor group-hover:text-tk-elements-fileTree-folder-iconColorHover",{"i-ph-folder-simple-duotone":a,"i-ph-folder-open-duotone":!a}),onClick:n,children:l})}function Z({file:{depth:e,name:l},onClick:a,selected:n}){return s.jsx(w,{className:g("group",{"bg-tk-elements-fileTree-file-backgroundColor hover:bg-tk-elements-fileTree-file-backgroundColorHover text-tk-elements-fileTree-file-textColor hover:text-tk-elements-fileTree-file-textColorHover":!n,"bg-tk-elements-fileTree-file-backgroundColorSelected text-tk-elements-fileTree-file-textColorSelected":n}),depth:e,iconClasses:g("i-ph-file-duotone",{"text-tk-elements-fileTree-file-iconColor group-hover:text-tk-elements-fileTree-file-iconColorHover":!n,"text-tk-elements-fileTree-file-iconColorSelected":n}),onClick:a,children:l})}function w({depth:e,iconClasses:l,onClick:a,className:n,children:t}){return s.jsxs("button",{className:`flex items-center gap-2 w-full pr-2 border-2 border-transparent text-faded ${n??""}`,style:{paddingLeft:`${12+e*W}px`},onClick:()=>a?.(),children:[s.jsx("div",{className:g("scale-120 shrink-0",l)}),s.jsx("span",{children:t})]})}function B(e,l,a,n){const t=new Set,o=[],k=l?0:1;l||o.push({kind:"folder",name:"/",depth:0,id:0});for(const m of e){if(a&&!m.startsWith(a))continue;const c=m.split("/").filter(f=>f),b=c.at(-1);if(!b||q(m,b,n))continue;let p="";for(let f=0;f<c.length;++f){const h=c[f],r=p+=`/${h}`;f===c.length-1?o.push({kind:"file",id:o.length,name:h,fullPath:r,depth:f+k}):t.has(r)||(t.add(r),o.push({kind:"folder",id:o.length,name:h,depth:f+k}))}}return o}function q(e,l,a){return a.some(n=>typeof n=="string"?l===n:n.test(e))}const J=25;function K({theme:e,id:l,files:a,hideRoot:n,fileTreeScope:t,showFileTree:o=!0,helpAction:k,editorDocument:m,selectedFile:c,onEditorChange:b,onEditorScroll:p,onHelpClick:f,onFileSelect:h}){const r=i.useRef(null);return i.useEffect(()=>{const{current:u}=r;u&&(o?u.isCollapsed()&&u.resize(J):o||u.collapse())},[l]),s.jsxs(F,{className:"bg-tk-elements-app-backgroundColor",direction:"horizontal",children:[s.jsxs(j,{className:"flex flex-col",collapsible:!0,defaultSize:0,minSize:10,ref:r,children:[s.jsx("div",{className:"panel-header border-r border-b border-tk-elements-app-borderColor",children:s.jsxs("div",{className:"panel-title",children:[s.jsx("div",{className:"panel-icon i-ph-tree-structure-duotone shrink-0"}),s.jsx("span",{className:"text-sm",children:"Files"})]})}),s.jsx(U,{className:"flex-grow py-2 border-r border-tk-elements-app-borderColor text-sm",selectedFile:c,hideRoot:n??!0,files:a,scope:t,onFileSelect:h})]}),s.jsx(v,{disabled:!o,className:N.PanelResizeHandle,hitAreaMargins:{fine:8,coarse:8}}),s.jsxs(j,{className:"flex flex-col",defaultSize:100,minSize:10,children:[s.jsx(Q,{editorDocument:m,onHelpClick:f,helpAction:k}),s.jsx("div",{className:"h-full flex-1 overflow-hidden",children:s.jsx(M,{theme:e,id:l,doc:m,autoFocusOnDocumentChange:!0,onScroll:p,onChange:b})})]})]})}function Q({editorDocument:e,helpAction:l,onHelpClick:a}){const t=e?.filePath?.split("/").at(-1)??"",o=t?V(t):"";return s.jsxs("div",{className:"panel-header border-b border-tk-elements-app-borderColor flex justify-between",children:[s.jsxs("div",{className:"panel-title",children:[s.jsx("div",{className:`panel-icon scale-125 ${o}`}),s.jsx("span",{className:"text-sm",children:t})]}),!!l&&s.jsxs("button",{onClick:a,className:"panel-button px-2 py-0.5 -mr-1 -my-1",children:[l==="solve"&&s.jsx("div",{className:"i-ph-lightbulb-duotone text-lg"}),l==="solve"&&"Solve",l==="reset"&&s.jsx("div",{className:"i-ph-clock-counter-clockwise-duotone"}),l==="reset"&&"Reset"]})]})}function V(e){const l=e.split(".").at(-1);if(!l)return console.error("Cannot infer file type"),null;switch(l){case"ts":return"i-languages-ts?mask";case"cjs":case"mjs":case"js":return"i-languages-js?mask";case"html":return"i-languages-html?mask";case"css":return"i-languages-css?mask";case"scss":case"sass":return"i-languages-sass?mask";case"md":return"i-languages-markdown?mask";case"json":return"i-languages-json?mask";case"gif":case"jpg":case"jpeg":case"png":return"i-ph-image";default:return null}}const S=25;function Y({tutorialStore:e,theme:l}){const a=e.hasFileTree(),n=e.hasEditor(),t=e.hasPreviews(),o=!e.hasTerminalPanel(),k=i.useRef(null),m=i.useRef(null),c=i.useRef(null),b=i.useRef(null),p=i.useRef(!1),[f,h]=i.useState("reset"),r=T(e.selectedFile),u=T(e.currentDocument),x=e.lesson,C=i.useCallback(d=>{e.setCurrentDocumentContent(d.content)},[]),R=i.useCallback(d=>{e.setCurrentDocumentScrollPosition(d)},[]),z=i.useCallback(d=>{e.setSelectedFile(d)},[]),D=i.useCallback(()=>{e.hasSolution()?h(d=>d==="reset"?(e.reset(),"solve"):(e.solve(),"reset")):e.reset()},[e.ref]);i.useEffect(()=>{const d=e.lesson,_=e.lessonFullyLoaded.subscribe(A=>{A&&d.data.autoReload});return e.hasSolution()?h("solve"):h("reset"),()=>_()},[e.ref]),i.useEffect(()=>{o&&(E(),p.current=!1)},[o]);const H=i.useCallback(()=>{const{current:d}=c;d&&(p.current?d.expand():(p.current=!0,d.resize(S)))},[]),E=i.useCallback(()=>{c.current?.collapse()},[]),L=i.useCallback(()=>{const{current:d}=c;d&&(c.current?.isCollapsed()?H():E())},[]);return s.jsxs(F,{className:N.PanelGroup,direction:"vertical",children:[s.jsx(j,{id:n?"editor-opened":"editor-closed",defaultSize:n?50:0,minSize:10,maxSize:n?100:0,collapsible:!n,ref:k,children:s.jsx(K,{id:e.ref,theme:l,showFileTree:a,editorDocument:u,files:x.files[1],hideRoot:x.data.hideRoot,helpAction:f,onHelpClick:D,onFileSelect:z,selectedFile:r,onEditorScroll:R,onEditorChange:C})}),s.jsx(v,{className:N.PanelResizeHandle,hitAreaMargins:{fine:5,coarse:5},disabled:!n}),s.jsx(j,{id:t?"previews-opened":"previews-closed",defaultSize:t?50:0,minSize:10,maxSize:t?100:0,collapsible:!t,ref:m,className:g({"border-t border-tk-elements-app-borderColor":n}),children:s.jsx(I,{tutorialStore:e,ref:b,showToggleTerminal:!o,toggleTerminal:L})}),s.jsx(v,{className:N.PanelResizeHandle,hitAreaMargins:{fine:5,coarse:5},disabled:o||!t}),s.jsx(j,{id:o?"terminal-none":!t&&!n?"terminal-full":t?"terminal-closed":"terminal-opened",defaultSize:o?0:!t&&!n?100:t?0:S,minSize:o?0:10,collapsible:t,ref:c,onExpand:()=>{p.current=!0},className:g({"border-t border-tk-elements-app-borderColor":t}),children:s.jsx(y,{tutorialStore:e,theme:l})})]})}function oe({lesson:e}){const l=T(G);return P.setLesson(e,{ssr:!1}),s.jsx(Y,{tutorialStore:P,theme:l})}export{oe as WorkspacePanelWrapper};
